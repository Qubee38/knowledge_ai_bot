# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [3å±¤è¨­è¨ˆ](#3å±¤è¨­è¨ˆ)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
4. [ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯](#ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)
5. [ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢](#ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢)
6. [è¨­å®šé§†å‹•è¨­è¨ˆ](#è¨­å®šé§†å‹•è¨­è¨ˆ)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend (React + TypeScript)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ±ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ ChatInterface                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ MessageList                        â”‚  â”‚
â”‚  â”‚  â””â”€ InputBox                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ WS /ws/chat
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend (FastAPI)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ConfigLoader                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ app.config.yamlèª­ã¿è¾¼ã¿            â”‚  â”‚
â”‚  â”‚  â”œâ”€ agents.config.yamlèª­ã¿è¾¼ã¿         â”‚  â”‚
â”‚  â”‚  â””â”€ domain.yamlèª­ã¿è¾¼ã¿                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AgentFactory                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ ãƒ„ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰                        â”‚  â”‚
â”‚  â”‚  â””â”€ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Agent (OpenAI GPT-4o)                 â”‚  â”‚
â”‚  â”‚  â””â”€ Function Calling                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ Tools â”‚  â”‚  DB    â”‚  â”‚ OpenAI â”‚
â”‚       â”‚  â”‚        â”‚  â”‚ API    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚  PostgreSQL      â”‚
â”‚  â”œâ”€ public       â”‚  # å…±é€šãƒ†ãƒ¼ãƒ–ãƒ«
â”‚  â”œâ”€ horse_racing â”‚  # ç«¶é¦¬ãƒ‰ãƒ¡ã‚¤ãƒ³
â”‚  â””â”€ customer_    â”‚  # ã‚µãƒãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³
â”‚     support      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3å±¤è¨­è¨ˆ

### Layer 1: è¨­å®šå±¤ï¼ˆYAMLï¼‰

```yaml
# app.config.yaml - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“è¨­å®š
app:
  active_domain: "horse-racing"  # â† ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ‡æ›¿

# agents.config.yaml - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŸºæœ¬è¨­å®š
agents:
  default:
    base_instructions: |
      ã‚ãªãŸã¯è¦ªåˆ‡ãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™...

# domains/horse-racing/domain.yaml - ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š
domain:
  id: "horse-racing"
  name: "ç«¶é¦¬ãƒŠãƒ¬ãƒƒã‚¸ãƒœãƒƒãƒˆ"
  
agent:
  prompt_templates:
    - "domain_instructions"
    - "analysis_procedure"
  
tools:
  enabled:
    - "get_race_statistics"

database:
  schema: "horse_racing"
```

**ç‰¹å¾´:**
- âœ… ã™ã¹ã¦ã®å‹•ä½œã‚’YAMLã§åˆ¶å¾¡
- âœ… ã‚³ãƒ¼ãƒ‰å¤‰æ›´ä¸è¦
- âœ… ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å¯èƒ½

---

### Layer 2: ã‚³ã‚¢å±¤ï¼ˆæ±ç”¨ãƒ»å†åˆ©ç”¨å¯èƒ½ï¼‰

```python
# backend/app/core/config.py
class ConfigLoader:
    """è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼"""
    
    def load_yaml(self, filename: str) -> Dict
    def get_active_domain_config(self) -> Dict
    # ...

# backend/app/core/tool_loader.py
class ToolLoader:
    """ãƒ„ãƒ¼ãƒ«å‹•çš„ãƒ­ãƒ¼ãƒ‰"""
    
    def load_tools_for_domain(self, domain_id: str) -> List[Callable]
    # ...

# backend/app/core/agent_factory.py
class AgentFactory:
    """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ"""
    
    def create_agent(self) -> Agent
    def _build_instructions(self) -> str
    # ...
```

**ç‰¹å¾´:**
- âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³éä¾å­˜
- âœ… å®Œå…¨ã«å†åˆ©ç”¨å¯èƒ½
- âœ… ãƒ†ã‚¹ãƒˆã—ã‚„ã™ã„

---

### Layer 3: ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼ˆå·®ã—æ›¿ãˆå¯èƒ½ï¼‰

```python
# backend/app/domains/horse_racing/tools.py
def get_race_statistics(race_name: str, category: str) -> List[Dict]:
    """ç«¶é¦¬ãƒ¬ãƒ¼ã‚¹çµ±è¨ˆå–å¾—"""
    # ç«¶é¦¬å›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
    pass

# backend/app/domains/customer_support/tools.py
def search_knowledge_base(query: str) -> List[Dict]:
    """ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹æ¤œç´¢"""
    # ã‚µãƒãƒ¼ãƒˆå›ºæœ‰ã®ãƒ­ã‚¸ãƒƒã‚¯
    pass
```

**ç‰¹å¾´:**
- âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰å®Ÿè£…
- âœ… ç‹¬ç«‹ã—ã¦é–‹ç™ºå¯èƒ½
- âœ… ç°¡å˜ã«å·®ã—æ›¿ãˆ

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ã‚¨ãƒªå‡¦ç†ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›
   "ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µã®å‚¾å‘ã‚’æ•™ãˆã¦"
   â†“
2. WebSocket â†’ Backend
   â†“
3. ConfigLoader
   â”œâ”€ active_domainå–å¾— â†’ "horse-racing"
   â”œâ”€ domain.yamlèª­ã¿è¾¼ã¿
   â””â”€ prompts.yamlèª­ã¿è¾¼ã¿
   â†“
4. AgentFactory
   â”œâ”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
   â”‚   â”œâ”€ base_instructions
   â”‚   â””â”€ domain_instructions
   â”œâ”€ ãƒ„ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰
   â”‚   â””â”€ get_race_statistics
   â””â”€ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ
   â†“
5. Agent (GPT-4o)
   â”œâ”€ ã‚¯ã‚¨ãƒªè§£æ
   â”œâ”€ Function Callingåˆ¤å®š
   â”‚   â””â”€ get_race_statistics("ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µ", "popularity")
   â””â”€ ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
   â†“
6. Toolå®Ÿè¡Œ
   â”œâ”€ db_utils.get_db_connection_for_domain()
   â”‚   â””â”€ SET search_path TO horse_racing
   â”œâ”€ SELECT * FROM races WHERE race_name = 'ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µ'
   â””â”€ ãƒ‡ãƒ¼ã‚¿å–å¾—
   â†“
7. Agentå¿œç­”ç”Ÿæˆ
   â”œâ”€ çµ±è¨ˆãƒ‡ãƒ¼ã‚¿åˆ†æ
   â”œâ”€ Markdownç”Ÿæˆ
   â””â”€ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é€ä¿¡
   â†“
8. Frontendè¡¨ç¤º
   â””â”€ react-markdownã§æç”»
```

---

## ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

### ConfigLoaderï¼ˆè¨­å®šç®¡ç†ï¼‰

**è²¬å‹™:**
- YAMLãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
- ç’°å¢ƒå¤‰æ•°å±•é–‹
- è¨­å®šå†…å‚ç…§è§£æ±º

**å®Ÿè£…ä¾‹:**

```python
class ConfigLoader:
    def __init__(self, config_dir: str = "/app/config"):
        self.config_dir = Path(config_dir)
        self._cache: Dict[str, Any] = {}
    
    def load_yaml(self, filename: str) -> Dict[str, Any]:
        """YAMLãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿"""
        if filename in self._cache:
            return self._cache[filename]
        
        filepath = self.config_dir / filename
        with open(filepath, 'r', encoding='utf-8') as f:
            config = yaml.safe_load(f)
        
        # ç’°å¢ƒå¤‰æ•°å±•é–‹ ${VAR_NAME}
        config = self._expand_env_vars(config)
        
        # ç›¸äº’å‚ç…§è§£æ±º ${llm.model}
        config = self._resolve_references(config, config)
        
        self._cache[filename] = config
        return config
    
    def get_active_domain_config(self) -> Dict[str, Any]:
        """ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šå–å¾—"""
        app_config = self.load_yaml("app.config.yaml")
        active_domain = app_config['app']['active_domain']
        return self.load_yaml(f"domains/{active_domain}/domain.yaml")
```

**ä½¿ç”¨ä¾‹:**

```python
config_loader = ConfigLoader()
domain_config = config_loader.get_active_domain_config()
# â†’ domains/horse-racing/domain.yaml ã®å†…å®¹
```

---

### ToolLoaderï¼ˆãƒ„ãƒ¼ãƒ«å‹•çš„ãƒ­ãƒ¼ãƒ‰ï¼‰

**è²¬å‹™:**
- ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ãƒ„ãƒ¼ãƒ«ã®å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- ãƒ„ãƒ¼ãƒ«é–¢æ•°ã®æ¤œå‡º
- ãƒ„ãƒ¼ãƒ«ãƒªã‚¹ãƒˆç”Ÿæˆ

**å®Ÿè£…ä¾‹:**

```python
class ToolLoader:
    def load_tools_for_domain(self, domain_id: str) -> List[Callable]:
        """ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ„ãƒ¼ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰"""
        module_name = f"app.domains.{domain_id.replace('-', '_')}.tools"
        
        try:
            module = importlib.import_module(module_name)
        except ImportError:
            return []
        
        tools = []
        for name in dir(module):
            obj = getattr(module, name)
            if callable(obj) and not name.startswith('_'):
                tools.append(obj)
        
        return tools
```

**ä½¿ç”¨ä¾‹:**

```python
tool_loader = ToolLoader()
tools = tool_loader.load_tools_for_domain("horse-racing")
# â†’ [get_race_statistics, analyze_elimination_conditions]
```

---

### AgentFactoryï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆï¼‰

**è²¬å‹™:**
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
- ãƒ„ãƒ¼ãƒ«çµ±åˆ
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆ

**å®Ÿè£…ä¾‹:**

```python
class AgentFactory:
    def create_agent(self) -> Agent:
        """ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ"""
        # 1. è¨­å®šèª­ã¿è¾¼ã¿
        domain_config = config_loader.get_active_domain_config()
        
        # 2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
        instructions = self._build_instructions()
        
        # 3. ãƒ„ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰
        tools = tool_loader.load_tools_for_domain(
            domain_config['domain']['id']
        )
        
        # 4. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ
        agent = Agent(
            name=domain_config['agent']['name'],
            model="gpt-4o",
            instructions=instructions,
            tools=tools
        )
        
        return agent
    
    def _build_instructions(self) -> str:
        """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰"""
        # base_instructions + domain_instructions
        pass
```

---

## ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

```
knowledge_ai_bot (Database)
â”‚
â”œâ”€â”€ public (Schema)              # å…±é€šãƒ†ãƒ¼ãƒ–ãƒ«
â”‚   â”œâ”€â”€ users                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼
â”‚   â”œâ”€â”€ conversations            # ä¼šè©±å±¥æ­´
â”‚   â””â”€â”€ sessions                 # ã‚»ãƒƒã‚·ãƒ§ãƒ³
â”‚
â”œâ”€â”€ horse_racing (Schema)        # ç«¶é¦¬ãƒ‰ãƒ¡ã‚¤ãƒ³
â”‚   â”œâ”€â”€ races                    # ãƒ¬ãƒ¼ã‚¹æƒ…å ±
â”‚   â”œâ”€â”€ race_results             # ãƒ¬ãƒ¼ã‚¹çµæœ
â”‚   â”œâ”€â”€ race_statistics          # çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ elimination_statistics   # æ¶ˆå»æ³•çµ±è¨ˆ
â”‚
â””â”€â”€ customer_support (Schema)    # ã‚µãƒãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³
    â”œâ”€â”€ tickets                  # ãƒã‚±ãƒƒãƒˆ
    â”œâ”€â”€ knowledge_base           # ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹
    â””â”€â”€ orders                   # æ³¨æ–‡æƒ…å ±
```

### ã‚¹ã‚­ãƒ¼ãƒåˆ‡æ›¿ã®ä»•çµ„ã¿

```python
# db_utils.py
def get_db_connection_for_domain():
    """ãƒ‰ãƒ¡ã‚¤ãƒ³ã®DBæ¥ç¶šå–å¾—"""
    domain_config = config_loader.get_active_domain_config()
    
    # ã‚¹ã‚­ãƒ¼ãƒåå–å¾—
    schema = domain_config.get('database', {}).get('schema', 'public')
    
    # æ¥ç¶š
    conn = psycopg2.connect(DATABASE_URL)
    cursor = conn.cursor()
    
    # ã‚¹ã‚­ãƒ¼ãƒè¨­å®šï¼ˆé‡è¦ï¼ï¼‰
    cursor.execute(f"SET search_path TO {schema}, public")
    
    return conn
```

**æ¤œç´¢ãƒ‘ã‚¹è¨­å®šå¾Œ:**

```sql
-- ã“ã®å¾Œã®ã‚¯ã‚¨ãƒªã¯è‡ªå‹•çš„ã« horse_racing ã‚¹ã‚­ãƒ¼ãƒã‚’å‚ç…§
SELECT * FROM races WHERE race_name = 'ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µ';
-- â†“ å®Ÿéš›ã«ã¯
SELECT * FROM horse_racing.races WHERE race_name = 'ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µ';
```

### ãƒ¡ãƒªãƒƒãƒˆ

âœ… **ãƒ‡ãƒ¼ã‚¿å®Œå…¨åˆ†é›¢**
- ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã§ãƒ†ãƒ¼ãƒ–ãƒ«åãŒè¡çªã—ãªã„
- èª¤ã£ã¦ä»–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãªã„

âœ… **ç®¡ç†ãŒå®¹æ˜“**
- 1ã¤ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ç®¡ç†
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒç°¡å˜
- æ¥ç¶šç®¡ç†ãŒã‚·ãƒ³ãƒ—ãƒ«

âœ… **æŸ”è»Ÿæ€§**
- æ–°ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ ãŒç°¡å˜ï¼ˆCREATE SCHEMAï¼‰
- ãƒ‰ãƒ¡ã‚¤ãƒ³å‰Šé™¤ã‚‚ç°¡å˜ï¼ˆDROP SCHEMA CASCADEï¼‰

---

## è¨­å®šé§†å‹•è¨­è¨ˆ

### ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ‡æ›¿ã®æµã‚Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app.config.yaml                â”‚
â”‚  active_domain: "horse-racing"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ConfigLoader                   â”‚
â”‚  get_active_domain_config()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  domains/horse-racing/          â”‚
â”‚  â”œâ”€ domain.yaml                 â”‚
â”‚  â””â”€ prompts.yaml                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AgentFactory                   â”‚
â”‚  â”œâ”€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰               â”‚
â”‚  â””â”€ ãƒ„ãƒ¼ãƒ«ãƒ­ãƒ¼ãƒ‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agentå®Ÿè¡Œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç’°å¢ƒå¤‰æ•°å±•é–‹

```yaml
# config/app.config.yaml
llm:
  api_key: "${OPENAI_API_KEY}"  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å±•é–‹
  endpoint: "${OPENAI_ENDPOINT}"
```

```python
# å±•é–‹å‡¦ç†
def _expand_env_vars(self, obj: Any) -> Any:
    if isinstance(obj, str):
        pattern = r'\$\{([^}]+)\}'
        matches = re.findall(pattern, obj)
        for match in matches:
            env_value = os.getenv(match, match)
            obj = obj.replace(f'${{{match}}}', env_value)
    return obj
```

### è¨­å®šå†…å‚ç…§

```yaml
# agents.config.yaml
agents:
  default:
    model: "gpt-4o"

# domains/horse-racing/domain.yaml
agent:
  model: "${agents.default.model}"  # å‚ç…§
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

```python
# ConfigLoaderã§YAMLã‚­ãƒ£ãƒƒã‚·ãƒ¥
class ConfigLoader:
    def __init__(self):
        self._cache: Dict[str, Any] = {}
    
    def load_yaml(self, filename: str):
        if filename in self._cache:
            return self._cache[filename]  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ
        # ... ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ ...
        self._cache[filename] = config
        return config
```

### æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°

```python
# PostgreSQLæ¥ç¶šãƒ—ãƒ¼ãƒ«
from psycopg2.pool import SimpleConnectionPool

pool = SimpleConnectionPool(
    minconn=1,
    maxconn=10,
    dsn=DATABASE_URL
)

def get_db_connection():
    return pool.getconn()
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ç’°å¢ƒå¤‰æ•°ç®¡ç†

```bash
# .envï¼ˆGitã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ï¼‰
OPENAI_API_KEY=sk-proj-xxx
DATABASE_URL=postgresql://...
```

```bash
# .gitignore
.env
.env.local
.env.*.local
```

### SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

```python
# âŒ NG: æ–‡å­—åˆ—çµåˆ
cursor.execute(f"SELECT * FROM races WHERE race_name = '{race_name}'")

# âœ… OK: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
cursor.execute("SELECT * FROM races WHERE race_name = %s", (race_name,))
```

### ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ä¿è­·

```python
# horse_racing ã‚¹ã‚­ãƒ¼ãƒã«è¨­å®š
cursor.execute("SET search_path TO horse_racing, public")

# customer_support ã®ãƒ‡ãƒ¼ã‚¿ã«ã¯è‡ªå‹•çš„ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„
cursor.execute("SELECT * FROM tickets")  # ã‚¨ãƒ©ãƒ¼
```

---

## ã¾ã¨ã‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç‰¹å¾´

âœ… **3å±¤è¨­è¨ˆ** - è¨­å®š / ã‚³ã‚¢ / ãƒ‰ãƒ¡ã‚¤ãƒ³  
âœ… **ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢** - ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿å®Œå…¨åˆ†é›¢  
âœ… **è¨­å®šé§†å‹•** - YAMLã§å…¨å‹•ä½œåˆ¶å¾¡  
âœ… **å‹•çš„ãƒ­ãƒ¼ãƒ‰** - ãƒ„ãƒ¼ãƒ«ãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‹•çš„ç”Ÿæˆ  
âœ… **æ‹¡å¼µæ€§** - æ–°ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ ãŒå®¹æ˜“  

### ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **è¨­å®šã¨ã‚³ãƒ¼ãƒ‰ã‚’åˆ†é›¢**
2. **æ±ç”¨éƒ¨åˆ†ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰éƒ¨åˆ†ã‚’æ˜ç¢ºã«åŒºåˆ¥**
3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã§ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ†é›¢**
4. **ç’°å¢ƒå¤‰æ•°ã§æ©Ÿå¯†æƒ…å ±ç®¡ç†**
5. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã§æ€§èƒ½æœ€é©åŒ–**

---

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚Šã€**ä¿å®ˆæ€§ãƒ»æ‹¡å¼µæ€§ãƒ»å†åˆ©ç”¨æ€§**ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿç¾ã§ãã¦ã„ã¾ã™ã€‚