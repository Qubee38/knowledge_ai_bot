# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å®Œå…¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**æœ€çµ‚æ›´æ–°**: 2026å¹´1æœˆ

---

## ğŸ“‹ ç›®æ¬¡

1. [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¦‚è¦](#è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¦‚è¦)
2. [app.config.yaml](#appconfigyaml)
3. [agents.config.yaml](#agentsconfigyaml)
4. [domain.yaml](#domainyaml)
5. [prompts.yaml](#promptsyaml)
6. [ç’°å¢ƒå¤‰æ•°](#ç’°å¢ƒå¤‰æ•°)
7. [è¨­å®šã®å„ªå…ˆé †ä½](#è¨­å®šã®å„ªå…ˆé †ä½)

---

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ¦‚è¦

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
config/
â”œâ”€â”€ app.config.yaml           # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“è¨­å®š
â”œâ”€â”€ agents.config.yaml        # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŸºæœ¬è¨­å®š
â””â”€â”€ domains/                  # ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥è¨­å®š
    â”œâ”€â”€ horse-racing/
    â”‚   â”œâ”€â”€ domain.yaml       # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰è¨­å®š
    â”‚   â””â”€â”€ prompts.yaml      # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â””â”€â”€ customer-support/
        â”œâ”€â”€ domain.yaml
        â””â”€â”€ prompts.yaml
```

### èª­ã¿è¾¼ã¿é †åº

```
1. app.config.yaml èª­ã¿è¾¼ã¿
   â†“
2. active_domain å–å¾—
   â†“
3. agents.config.yaml èª­ã¿è¾¼ã¿
   â†“
4. domains/{active_domain}/domain.yaml èª­ã¿è¾¼ã¿
   â†“
5. domains/{active_domain}/prompts.yaml èª­ã¿è¾¼ã¿
   â†“
6. è¨­å®šçµ±åˆãƒ»ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”Ÿæˆ
```

---

## app.config.yaml

**ãƒ‘ã‚¹:** `config/app.config.yaml`

### å®Œå…¨ãªè¨­å®šä¾‹

```yaml
# ========================================
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºæœ¬è¨­å®š
# ========================================
app:
  name: "æ±ç”¨LLMãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆ"
  version: "1.0.0"
  environment: "development"  # development, staging, production
  
  # ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆé‡è¦ï¼ï¼‰
  active_domain: "horse-racing"

# ========================================
# LLMè¨­å®š
# ========================================
llm:
  provider: "openai"
  api_key: "${OPENAI_API_KEY}"    # ç’°å¢ƒå¤‰æ•°å±•é–‹
  model: "gpt-4o"
  api_version: "2024-02-01"
  max_tokens: 4000
  temperature: 0.7
  streaming: true
  timeout: 60

# ========================================
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
# ========================================
database:
  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿
  url: "${DATABASE_URL}"
  
  # æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š
  pool_size: 10
  max_overflow: 20
  pool_timeout: 30
  pool_recycle: 3600
  
  # SSLè¨­å®š
  ssl_mode: "prefer"  # disable, allow, prefer, require

# ========================================
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥
# ========================================
cache:
  provider: "redis"
  url: "${REDIS_URL}"
  ttl: 3600             # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆTTLï¼ˆç§’ï¼‰
  max_connections: 50
  
  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹
  key_prefix: "llm_bot:"

# ========================================
# ã‚»ãƒƒã‚·ãƒ§ãƒ³
# ========================================
session:
  provider: "redis"
  timeout: 1800         # 30åˆ†
  cookie_secure: true   # HTTPSç’°å¢ƒã§ã¯true
  cookie_httponly: true
  cookie_samesite: "lax"

# ========================================
# ãƒ­ã‚®ãƒ³ã‚°
# ========================================
logging:
  level: "INFO"         # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "json"        # json, text
  output: "stdout"      # stdout, file
  
  # ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›è¨­å®š
  file:
    path: "/var/log/app.log"
    max_bytes: 10485760  # 10MB
    backup_count: 5

# ========================================
# CORSè¨­å®š
# ========================================
cors:
  allow_origins:
    - "http://localhost:3000"
    - "https://yourdomain.com"
  allow_credentials: true
  allow_methods:
    - "GET"
    - "POST"
    - "OPTIONS"
  allow_headers:
    - "Content-Type"
    - "Authorization"

# ========================================
# ãƒ¬ãƒ¼ãƒˆåˆ¶é™
# ========================================
rate_limit:
  enabled: true
  requests_per_minute: 60
  requests_per_hour: 1000
  burst: 10

# ========================================
# ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹
# ========================================
monitoring:
  enabled: true
  metrics_interval: 60
  
  # Application Insightsï¼ˆAzureï¼‰
  application_insights:
    enabled: false
    instrumentation_key: "${APPINSIGHTS_KEY}"

# ========================================
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
# ========================================
security:
  # CSRFä¿è­·
  csrf_protection: true
  
  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
  security_headers:
    x_content_type_options: "nosniff"
    x_frame_options: "DENY"
    x_xss_protection: "1; mode=block"
```

### ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|----------|
| `app.active_domain` | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ID | - |
| `llm.api_key` | OpenAI APIã‚­ãƒ¼ | ç’°å¢ƒå¤‰æ•° |
| `llm.model` | ä½¿ç”¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ« | `gpt-4o` |
| `database.url` | DBæ¥ç¶šURL | ç’°å¢ƒå¤‰æ•° |
| `cache.ttl` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTLï¼ˆç§’ï¼‰ | `3600` |
| `logging.level` | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« | `INFO` |

---

## agents.config.yaml

**ãƒ‘ã‚¹:** `config/agents.config.yaml`

### å®Œå…¨ãªè¨­å®šä¾‹

```yaml
# ========================================
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
# ========================================
agents:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
  default:
    name: "AssistantAgent"
    model: "${llm.model}"           # app.config.yamlå‚ç…§
    temperature: "${llm.temperature}"
    max_tokens: "${llm.max_tokens}"
    streaming: "${llm.streaming}"
    
    # åŸºæœ¬æŒ‡ç¤ºï¼ˆå…¨ãƒ‰ãƒ¡ã‚¤ãƒ³å…±é€šï¼‰
    base_instructions: |
      ã‚ãªãŸã¯è¦ªåˆ‡ã§çŸ¥è­˜è±Šå¯ŒãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
      
      ## åŸºæœ¬åŸå‰‡
      1. æ­£ç¢ºã§å®¢è¦³çš„ãªæƒ…å ±ã‚’æä¾›
      2. ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸåˆ†æ
      3. åˆ†ã‹ã‚Šã‚„ã™ãç°¡æ½”ãªèª¬æ˜
      4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’ç†è§£
      
      ## å‡ºåŠ›ã‚¹ã‚¿ã‚¤ãƒ«
      - Markdownå½¢å¼ã§æ§‹é€ åŒ–
      - è¡¨ã‚„ã‚°ãƒ©ãƒ•ã‚’æ´»ç”¨
      - é‡è¦ãƒã‚¤ãƒ³ãƒˆã‚’å¼·èª¿
      - æ ¹æ‹ ã‚’æ˜ç¤º
      
      ## åˆ¶ç´„
      - æ¨æ¸¬ã‚„æ†¶æ¸¬ã¯é¿ã‘ã‚‹
      - ä¸ç¢ºå®Ÿãªæƒ…å ±ã¯æ˜ç¤º
      - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡
    
    # ãƒ„ãƒ¼ãƒ«è¨­å®š
    tools:
      enabled: true
      timeout: 30
      retry: 3
      max_parallel: 5
  
  # å°‚é–€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®šï¼ˆå°†æ¥çš„ãªæ‹¡å¼µç”¨ï¼‰
  specialized:
    - name: "AnalyzerAgent"
      role: "ãƒ‡ãƒ¼ã‚¿åˆ†æ"
      enabled: false
      
    - name: "RecommenderAgent"
      role: "æ¨å¥¨ãƒ»ææ¡ˆ"
      enabled: false

# ========================================
# Handoffsè¨­å®šï¼ˆãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰
# ========================================
handoffs:
  enabled: false      # MVPç‰ˆã§ã¯ç„¡åŠ¹
  strategy: "manual"  # manual, automatic
  confirmation_required: true
  
  # Handoffå…ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
  agents:
    - from: "AssistantAgent"
      to: "AnalyzerAgent"
      trigger: "è©³ç´°ãªåˆ†æãŒå¿…è¦"
    
    - from: "AnalyzerAgent"
      to: "RecommenderAgent"
      trigger: "æ¨å¥¨ã‚’ç”Ÿæˆ"

# ========================================
# ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
# ========================================
error_handling:
  # ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  error_messages:
    tool_error: "ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"
    timeout: "å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚"
    api_error: "APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"
  
  # ãƒªãƒˆãƒ©ã‚¤è¨­å®š
  retry:
    max_attempts: 3
    backoff_factor: 2
    backoff_max: 30

# ========================================
# ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
# ========================================
token_management:
  # è­¦å‘Šé–¾å€¤
  warning_threshold: 0.8  # 80%ã§warning
  
  # æœ€å¤§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
  max_context_tokens: 128000
  
  # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸®
  compression:
    enabled: true
    strategy: "summarize"  # truncate, summarize
```

### ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|-----------|------|----------|
| `default.base_instructions` | å…¨ãƒ‰ãƒ¡ã‚¤ãƒ³å…±é€šã®åŸºæœ¬æŒ‡ç¤º | - |
| `default.tools.timeout` | ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰ | `30` |
| `handoffs.enabled` | ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæœ‰åŠ¹åŒ– | `false` |
| `error_handling.retry.max_attempts` | ãƒªãƒˆãƒ©ã‚¤æœ€å¤§å›æ•° | `3` |

---

## domain.yaml

**ãƒ‘ã‚¹:** `config/domains/{domain-id}/domain.yaml`

### å®Œå…¨ãªè¨­å®šä¾‹

```yaml
# ========================================
# ãƒ‰ãƒ¡ã‚¤ãƒ³åŸºæœ¬æƒ…å ±
# ========================================
domain:
  id: "horse-racing"
  name: "ç«¶é¦¬ãƒŠãƒ¬ãƒƒã‚¸ãƒœãƒƒãƒˆ"
  description: "ãƒ¬ãƒ¼ã‚¹å‚¾å‘åˆ†æã¨ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³æ¨å¥¨"
  version: "1.0.0"
  author: "Masato"
  
  # ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata:
    category: "sports-analytics"
    tags:
      - "horse-racing"
      - "statistics"
      - "prediction"
    keywords:
      - "ç«¶é¦¬"
      - "ãƒ¬ãƒ¼ã‚¹åˆ†æ"
      - "å‚¾å‘"

# ========================================
# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
# ========================================
agent:
  name: "RaceTrendAnalyzer"
  
  # ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€çœç•¥æ™‚ã¯agents.config.yamlã‹ã‚‰ï¼‰
  model: "gpt-4o"
  temperature: 0.7
  max_tokens: 4000
  
  # ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚­ãƒ¼
  prompt_templates:
    - "domain_instructions"
    - "data_reliability_guide"
    - "analysis_procedure"
    - "output_format"
    - "key_principles"
  
  # ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ è¨­å®š
  system_prompt:
    prepend: true  # base_instructionsã®å‰ã«è¿½åŠ 
    append: false  # base_instructionsã®å¾Œã«è¿½åŠ 

# ========================================
# ãƒ„ãƒ¼ãƒ«è¨­å®š
# ========================================
tools:
  # æœ‰åŠ¹åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ«é–¢æ•°å
  enabled:
    - "get_race_statistics"
    - "analyze_elimination_conditions"
  
  # ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œè¨­å®š
  execution:
    parallel: true      # ä¸¦åˆ—å®Ÿè¡Œ
    timeout: 30
    retry: 3
  
  # ãƒ„ãƒ¼ãƒ«èª¬æ˜ã®ä¸Šæ›¸ãï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  overrides:
    get_race_statistics:
      description: "ã‚«ã‚¹ã‚¿ãƒ èª¬æ˜"

# ========================================
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
# ========================================
database:
  # ã‚¹ã‚­ãƒ¼ãƒåï¼ˆå¿…é ˆï¼‰
  schema: "horse_racing"
  
  # ã‚¹ã‚­ãƒ¼ãƒåˆ†é›¢ã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
  use_schema_separation: true
  
  # æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  pool_size: 5
  timeout: 20
  
  # ã‚¹ã‚­ãƒ¼ãƒä½œæˆSQLãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  schema_file: "database/schema/domains/horse_racing_schema.sql"
  
  # ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  seed_files:
    - "database/seeds/domains/horse_racing/races.csv"
    - "database/seeds/domains/horse_racing/race_results.csv"

# ========================================
# UIè¨­å®š
# ========================================
ui:
  # ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼
  theme:
    primary: "#4A90E2"     # ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼
    secondary: "#50C878"   # ã‚µãƒ–ã‚«ãƒ©ãƒ¼
    accent: "#FF6B6B"      # ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼
    background: "#FFFFFF"  # èƒŒæ™¯è‰²
    text: "#333333"        # ãƒ†ã‚­ã‚¹ãƒˆè‰²
  
  # ãƒ­ã‚´ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
  branding:
    logo_url: "/static/logos/horse-racing.png"
    favicon_url: "/static/favicons/horse-racing.ico"
  
  # ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼‰
  quick_actions:
    - label: "ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µã®å‚¾å‘"
      query: "ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µã®å‚¾å‘ã‚’æ•™ãˆã¦"
      icon: "ğŸ‡"
      category: "G3ãƒ¬ãƒ¼ã‚¹"
    
    - label: "æœ‰é¦¬è¨˜å¿µã®å‚¾å‘"
      query: "æœ‰é¦¬è¨˜å¿µã®å‚¾å‘ã‚’æ•™ãˆã¦"
      icon: "ğŸ†"
      category: "G1ãƒ¬ãƒ¼ã‚¹"
    
    - label: "ä»Šé€±æœ«ã®G1"
      query: "ä»Šé€±æœ«ã®G1ãƒ¬ãƒ¼ã‚¹ã‚’åˆ†æã—ã¦"
      icon: "ğŸ“…"
      category: "äºˆå®š"
  
  # ã‚µãƒ³ãƒ—ãƒ«ã‚¯ã‚¨ãƒªï¼ˆå…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ä¸‹ï¼‰
  sample_queries:
    - "ã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µ2026ã®å‚¾å‘ã¯ï¼Ÿ"
    - "æœ‰é¦¬è¨˜å¿µã§ç‹™ã†ã¹ãé¦¬ã®æ¡ä»¶ã¯ï¼Ÿ"
    - "ä»Šå¹´ã®çšæœˆè³ã§ãŠã™ã™ã‚ã®é¦¬ã¯ï¼Ÿ"
  
  # ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  welcome_message: |
    ç«¶é¦¬ãƒŠãƒ¬ãƒƒã‚¸ãƒœãƒƒãƒˆã¸ã‚ˆã†ã“ãï¼
    ãƒ¬ãƒ¼ã‚¹ã®å‚¾å‘åˆ†æã‚„ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ¨å¥¨ã‚’æä¾›ã—ã¾ã™ã€‚
  
  # ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼
  input_placeholder: "ãƒ¬ãƒ¼ã‚¹åã‚„è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
  
  # æ©Ÿèƒ½ãƒ•ãƒ©ã‚°
  features:
    show_quick_actions: true
    show_sample_queries: true
    show_welcome_message: true
    enable_voice_input: false
    enable_file_upload: false

# ========================================
# ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»åˆ†æ
# ========================================
metrics:
  # ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  custom_metrics:
    - name: "races_analyzed"
      description: "åˆ†æã—ãŸãƒ¬ãƒ¼ã‚¹æ•°"
      type: "counter"
    
    - name: "predictions_made"
      description: "äºˆæ¸¬å®Ÿè¡Œå›æ•°"
      type: "counter"
    
    - name: "average_analysis_time"
      description: "å¹³å‡åˆ†ææ™‚é–“ï¼ˆç§’ï¼‰"
      type: "gauge"
  
  # ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
  events:
    - name: "race_analysis_started"
      properties:
        - "race_name"
        - "category"
    
    - name: "recommendation_generated"
      properties:
        - "race_name"
        - "horse_count"

# ========================================
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
# ========================================
cache:
  # ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTL
  ttl:
    race_statistics: 86400    # 24æ™‚é–“
    race_results: 3600        # 1æ™‚é–“
    default: 1800             # 30åˆ†
  
  # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ç”Ÿæˆ
  key_strategy: "domain_function_args"

# ========================================
# åˆ¶é™ãƒ»ã‚¯ã‚©ãƒ¼ã‚¿
# ========================================
limits:
  # ã‚¯ã‚¨ãƒªåˆ¶é™
  max_queries_per_hour: 100
  max_queries_per_day: 500
  
  # ãƒ¬ã‚¹ãƒãƒ³ã‚¹åˆ¶é™
  max_response_length: 10000
  
  # ãƒ„ãƒ¼ãƒ«åˆ¶é™
  max_tool_calls_per_query: 10

# ========================================
# å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# ========================================
integrations:
  # Webhook
  webhooks:
    - url: "https://example.com/webhook"
      events:
        - "analysis_completed"
      headers:
        Authorization: "Bearer ${WEBHOOK_TOKEN}"
  
  # å¤–éƒ¨API
  external_apis:
    racing_api:
      base_url: "https://api.racing-data.com"
      api_key: "${RACING_API_KEY}"
      timeout: 10

# ========================================
# é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°
# ========================================
debug:
  # ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰
  enabled: false
  
  # è©³ç´°ãƒ­ã‚°
  verbose_logging: false
  
  # ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œãƒ­ã‚°
  log_tool_calls: true
  log_tool_results: true
```

### ä¸»è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | èª¬æ˜ | å¿…é ˆ |
|-----------|------|-----|
| `domain.id` | ãƒ‰ãƒ¡ã‚¤ãƒ³ID | âœ… |
| `domain.name` | è¡¨ç¤ºå | âœ… |
| `agent.prompt_templates` | ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚­ãƒ¼ | âœ… |
| `tools.enabled` | æœ‰åŠ¹åŒ–ã™ã‚‹ãƒ„ãƒ¼ãƒ« | âœ… |
| `database.schema` | DBã‚¹ã‚­ãƒ¼ãƒå | âœ… |
| `ui.theme` | UIãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ | â­• |

---

## prompts.yaml

**ãƒ‘ã‚¹:** `config/domains/{domain-id}/prompts.yaml`

### å®Œå…¨ãªè¨­å®šä¾‹

```yaml
# ========================================
# ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰æŒ‡ç¤ºï¼ˆå¿…é ˆï¼‰
# ========================================
domain_instructions: |
  ã‚ãªãŸã¯ç«¶é¦¬ãƒ¬ãƒ¼ã‚¹ã®å‚¾å‘åˆ†æã®å°‚é–€å®¶ã§ã™ã€‚
  éå»ãƒ‡ãƒ¼ã‚¿ã‚’çµ±è¨ˆçš„ã«åˆ†æã—ã€å®¢è¦³çš„ãªå‚¾å‘ã‚’æç¤ºã—ã¾ã™ã€‚
  
  ## å½¹å‰²
  - éå»ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆåˆ†æ
  - äººæ°—åˆ¥ãƒ»æ é †åˆ¥ãƒ»è„šè³ªåˆ¥ã®å‚¾å‘æŠ½å‡º
  - ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªæ¨å¥¨é¦¬é¸å®š
  
  ## å°‚é–€çŸ¥è­˜
  - ç«¶é¦¬ãƒ¬ãƒ¼ã‚¹ã®åŸºæœ¬çŸ¥è­˜
  - çµ±è¨ˆåˆ†ææ‰‹æ³•
  - ãƒ‡ãƒ¼ã‚¿è§£é‡ˆã‚¹ã‚­ãƒ«

# ========================================
# ãƒ‡ãƒ¼ã‚¿ä¿¡é ¼æ€§ã‚¬ã‚¤ãƒ‰
# ========================================
data_reliability_guide: |
  ## ãƒ‡ãƒ¼ã‚¿ã®ä¿¡é ¼æ€§ã«ã¤ã„ã¦
  
  ### é«˜ä¿¡é ¼æ€§ãƒ‡ãƒ¼ã‚¿
  - äººæ°—åˆ¥æˆç¸¾ï¼ˆå®Œå…¨ãƒ‡ãƒ¼ã‚¿ï¼‰
  - æ é †åˆ¥æˆç¸¾ï¼ˆå®Œå…¨ãƒ‡ãƒ¼ã‚¿ï¼‰
  - æ¶ˆå»æ³•ãƒ‡ãƒ¼ã‚¿ï¼ˆå‰èµ°æƒ…å ±ï¼‰
  
  ### å‚è€ƒå€¤ãƒ‡ãƒ¼ã‚¿
  - è„šè³ªåˆ¥æˆç¸¾ï¼ˆ3ç€ä»¥å†…ã®ã¿ï¼‰
  - ä¸ŠãŒã‚Š3Fé †ä½åˆ¥ï¼ˆä¸€éƒ¨ãƒ‡ãƒ¼ã‚¿ï¼‰
  
  **æ³¨æ„:** å‚è€ƒå€¤ãƒ‡ãƒ¼ã‚¿ã¯å‚¾å‘æŠŠæ¡ã«ä½¿ç”¨ã—ã€
  æ¨å¥¨ã®æ ¹æ‹ ã«ã¯é«˜ä¿¡é ¼æ€§ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

# ========================================
# åˆ†ææ‰‹é †
# ========================================
analysis_procedure: |
  ## åˆ†ææ‰‹é †
  
  1. ãƒ¬ãƒ¼ã‚¹åãƒ»é–‹å‚¬æƒ…å ±ã®ç‰¹å®š
  2. éå»ãƒ‡ãƒ¼ã‚¿åé›†ï¼ˆãƒ„ãƒ¼ãƒ«ä½¿ç”¨ï¼‰
     - get_race_statistics("ãƒ¬ãƒ¼ã‚¹å", "popularity")
     - get_race_statistics("ãƒ¬ãƒ¼ã‚¹å", "post_position")
  3. çµ±è¨ˆåˆ†æã®å®Ÿè¡Œ
  4. å‚¾å‘ã®æŠ½å‡ºãƒ»è§£é‡ˆ
  5. æ¨å¥¨é¦¬ã®é¸å®šï¼ˆæ¡ä»¶ã‚¯ãƒªã‚¢é¦¬ï¼‰

# ========================================
# å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
# ========================================
output_format: |
  ## å‡ºåŠ›å½¢å¼
  
  ### 1. ãƒ¬ãƒ¼ã‚¹æ¦‚è¦
  - ãƒ¬ãƒ¼ã‚¹åã€é–‹å‚¬æ—¥ã€ç«¶é¦¬å ´
  - éå»Xå¹´ã®å‚¾å‘ã‚µãƒãƒªãƒ¼
  
  ### 2. äººæ°—ãƒ‡ãƒ¼ã‚¿åˆ†æ
  | äººæ°— | å‹ç‡ | è¤‡å‹ç‡ | å˜å›å€¤ | è¤‡å›å€¤ |
  |------|------|--------|--------|--------|
  
  **åˆ†æçµæœ:**
  - å°æ³¢ä¹±/å¤§æ³¢ä¹±/å …ã„å‚¾å‘ã®åˆ¤å®š
  - äººæ°—é¦¬ã®ä¿¡é ¼åº¦è©•ä¾¡
  
  ### 3. æ é †ãƒ‡ãƒ¼ã‚¿åˆ†æ
  | æ ç•ª | å‹ç‡ | è¤‡å‹ç‡ |
  |------|------|--------|
  
  **å‚¾å‘:**
  - å†…æ /å¤–æ æœ‰åˆ©ã®åˆ¤å®š
  
  ### 4. æ¨å¥¨é¦¬
  **æ¡ä»¶ã‚¯ãƒªã‚¢çŠ¶æ³:**
  ```
  âœ… æ¡ä»¶1
  âœ… æ¡ä»¶2
  â†’ è©²å½“é¦¬: â—‹â—‹â—‹â—‹
  ```

# ========================================
# é‡è¦ãªåŸå‰‡
# ========================================
key_principles: |
  ## é‡è¦ãªåŸå‰‡
  
  1. **ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸå®¢è¦³çš„åˆ†æ**
     - æ¨æ¸¬ã‚„æ†¶æ¸¬ã¯é¿ã‘ã‚‹
     - çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’æ ¹æ‹ ã«æç¤º
  
  2. **å›åç‡100%è¶…ã®æ¡ä»¶ã‚’å¼·èª¿**
     - å˜å›å€¤ãƒ»è¤‡å›å€¤ãŒ100è¶…ã®æ¡ä»¶
     - éå»å®Ÿç¸¾ãŒå„ªã‚ŒãŸæ¡ä»¶
  
  3. **æ¨å¥¨ç†ç”±ã‚’æ˜ç¢ºã«èª¬æ˜**
     - ãªãœãã®é¦¬ã‚’æ¨å¥¨ã™ã‚‹ã®ã‹
     - ã©ã®ãƒ‡ãƒ¼ã‚¿ãŒãã®æ ¹æ‹ ã‹
  
  4. **æ ¹æ‹ ã®ãªã„æ¨æ¸¬ã¯é¿ã‘ã‚‹**
     - ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯æ˜ç¤º
     - ä¸ç¢ºå®Ÿæ€§ã‚’æ­£ç›´ã«ä¼ãˆã‚‹

# ========================================
# ãƒˆãƒ¼ãƒ³ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«
# ========================================
tone_and_style: |
  ## ãƒˆãƒ¼ãƒ³
  - ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«
  - å®¢è¦³çš„
  - åˆ†ã‹ã‚Šã‚„ã™ã„
  
  ## ã‚¹ã‚¿ã‚¤ãƒ«
  - ç°¡æ½”ãªè¡¨ç¾
  - ãƒ‡ãƒ¼ã‚¿é‡è¦–
  - æ§‹é€ åŒ–ã•ã‚ŒãŸèª¬æ˜

# ========================================
# ä¾‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# ========================================
examples: |
  ## è‰¯ã„åˆ†æä¾‹
  
  ã€Œã‚·ãƒ³ã‚¶ãƒ³è¨˜å¿µã§ã¯1-3ç•ªäººæ°—ã®å‹ç‡ãŒé«˜ãã€
  å›åç‡ã‚‚100%ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼ˆå˜å›å€¤118ï¼‰ã€‚
  å†…æ ï¼ˆ1-4æ ï¼‰ã®æˆç¸¾ãŒè‰¯å¥½ã§ã€è¤‡å‹ç‡50%è¶…ã§ã™ã€‚ã€
  
  ## æ‚ªã„åˆ†æä¾‹
  
  ã€Œã“ã®ãƒ¬ãƒ¼ã‚¹ã¯è’ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚
  ç©´é¦¬ã‚’ç‹™ã†ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚ã€
  ï¼ˆæ ¹æ‹ ãƒ‡ãƒ¼ã‚¿ãŒãªã„ï¼‰

# ========================================
# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# ========================================
error_messages: |
  ## ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼
  ã€Œç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚{ãƒ¬ãƒ¼ã‚¹å}ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
  ãƒ¬ãƒ¼ã‚¹åãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã€
  
  ## ãƒ‡ãƒ¼ã‚¿ä¸è¶³
  ã€Œ{ãƒ¬ãƒ¼ã‚¹å}ã®{ã‚«ãƒ†ã‚´ãƒª}ãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹ãŸã‚ã€
  ååˆ†ãªåˆ†æãŒã§ãã¾ã›ã‚“ã€‚ã€
```

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚­ãƒ¼

| ã‚­ãƒ¼ | èª¬æ˜ | å¿…é ˆ |
|------|------|-----|
| `domain_instructions` | ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®æŒ‡ç¤º | âœ… |
| `analysis_procedure` | åˆ†ææ‰‹é † | â­• |
| `output_format` | å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ | â­• |
| `key_principles` | é‡è¦ãªåŸå‰‡ | â­• |
| `examples` | ä¾‹ | â­• |

---

## ç’°å¢ƒå¤‰æ•°

### .env ãƒ•ã‚¡ã‚¤ãƒ«

```bash
# ========================================
# OpenAI
# ========================================
OPENAI_API_KEY=sk-proj-your-key-here

# ========================================
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
# ========================================
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
DATABASE_URL=postgresql://postgres:password@postgres:5432/knowledge_ai_bot

# æœ¬ç•ªï¼ˆNeonç­‰ï¼‰
# DATABASE_URL=postgresql://user:pass@host:5432/knowledge_ai_bot?sslmode=require

# ========================================
# Redis
# ========================================
REDIS_URL=redis://redis:6379/0

# ========================================
# ãã®ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹
# ========================================
RACING_API_KEY=your-racing-api-key
WEBHOOK_TOKEN=your-webhook-token
APPINSIGHTS_KEY=your-appinsights-key
```

### ç’°å¢ƒå¤‰æ•°å±•é–‹

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ `${VAR_NAME}` å½¢å¼ã§å‚ç…§ï¼š

```yaml
# app.config.yaml
llm:
  api_key: "${OPENAI_API_KEY}"  # â† ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿è¾¼ã¿

database:
  url: "${DATABASE_URL}"
```

---

## è¨­å®šã®å„ªå…ˆé †ä½

### å„ªå…ˆé †ä½ï¼ˆé«˜â†’ä½ï¼‰

```
1. domain.yaml ã®è¨­å®š
   â†“
2. agents.config.yaml ã®è¨­å®š
   â†“
3. app.config.yaml ã®è¨­å®š
   â†“
4. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```

### å…·ä½“ä¾‹

```yaml
# app.config.yaml
llm:
  temperature: 0.7

# agents.config.yaml
agents:
  default:
    temperature: 0.8  # â† ã“ã‚ŒãŒå„ªå…ˆ

# domains/my-domain/domain.yaml
agent:
  temperature: 0.9  # â† ã“ã‚ŒãŒæœ€å„ªå…ˆ

# çµæœ: 0.9 ãŒä½¿ç”¨ã•ã‚Œã‚‹
```

---

## ã¾ã¨ã‚

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|---------|------|
| `app.config.yaml` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“è¨­å®š |
| `agents.config.yaml` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŸºæœ¬è¨­å®š |
| `domain.yaml` | ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰è¨­å®š |
| `prompts.yaml` | ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ |

### è¨­å®šå¤‰æ›´æ™‚ã®æ‰‹é †

```
1. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†
   â†“
2. docker-compose restart backend
   â†“
3. å‹•ä½œç¢ºèª
```

---

ã“ã‚Œã§è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªåœ¨ã«æ“ã‚Œã¾ã™ï¼